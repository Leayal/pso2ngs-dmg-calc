var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}},"es7","es3");const STRINGPLACEHOLDER_UIPSO2AbilitySelect="<No Special Ability>";
class UIPSO2AbilitySelect extends UIPSO2Element{constructor(a){void 0===a&&(a=UIPSO2AbilitySelectPopup.default);if(!(a instanceof UIPSO2AbilitySelectPopup))throw new TypeError("'datalist' must be an instance of UIPSO2AbilitySelectPopup");var b=document.createElement("div");const c=document.createElement("input"),d=document.createElement("button");b.classList.add("input-group");c.type="text";c.readOnly=!0;c.placeholder=STRINGPLACEHOLDER_UIPSO2AbilitySelect;b.appendChild(c);d.classList.add("btn","btn-outline-secondary",
"dropdown-toggle");b.appendChild(d);super(b);b=a.register(d);b.onPopupShowing=UIPSO2AbilitySelect.onDropdownShowing.bind(this);b.onPopupShown=UIPSO2AbilitySelect.onDropdownShown.bind(this);b.onSelection=UIPSO2AbilitySelect.onDropdownSelection.bind(this);Object.defineProperties(this,{__input__:{configurable:!1,enumerable:!1,value:c,writable:!1},__datalist__:{configurable:!1,enumerable:!1,value:a,writable:!1}})}}
UIPSO2AbilitySelect.onDropdownShowing=function(a,b){b=this.__input__.value;a.inputElement.value="";if(b)a.selectedItem=b;else{a.deselectItem();let c;null==(c=a.itemsElement.firstElementChild)||c.focus({preventScroll:!1})}};UIPSO2AbilitySelect.onDropdownShown=function(a,b){if(b=a.selectedElement)b.focus({preventScroll:!1});else{let c;null==(c=a.itemsElement.firstElementChild)||c.focus({preventScroll:!1})}};UIPSO2AbilitySelect.onDropdownSelection=function(a,b){this.__input__.value=`${b.ability.name} ${b.level}`};class UIPSO2AbilitySelectPopup extends UIPSO2Element{static get default(){return UIPSO2AbilitySelectPopup.__instance__?UIPSO2AbilitySelectPopup.__instance__:UIPSO2AbilitySelectPopup.__instance__=new UIPSO2AbilitySelectPopup}constructor(){const a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("span"),d=document.createElement("input"),e=document.createElement("hr"),f=document.createElement("div");b.classList.add("input-group","input-group-sm");c.classList.add("input-group-text");
c.textContent="Filter";b.appendChild(c);d.classList.add("form-control");d.placeholder="<Filter by name>";d.type="text";b.appendChild(d);e.classList.add("dropdown-divider");f.classList.add("list-group","pso2-ability-list-select");a.appendChild(b);a.appendChild(e);a.appendChild(f);for(const g of AbilityTable.abilities)for(const h of UIPSO2AbilitySelectPopup.createOptions(g))f.appendChild(h);super(a);Object.defineProperties(this,{__input__:{configurable:!1,enumerable:!1,value:d,writable:!1},__list__:{configurable:!1,
enumerable:!1,value:f,writable:!1},__onInputTextChanged__:{configurable:!1,enumerable:!1,value:UIPSO2AbilitySelectPopup.onInputTextChanged.bind(this),writable:!1},__onSelecting__:{configurable:!1,enumerable:!1,value:UIPSO2AbilitySelectPopup.onSelecting.bind(this),writable:!1},__onFocusCheck__:{configurable:!1,enumerable:!1,value:UIPSO2AbilitySelectPopup.onFocusCheck.bind(this),writable:!1},__optionElements__:{configurable:!1,enumerable:!1,value:f.childNodes,writable:!1},register:{configurable:!1,
enumerable:!0,value:this.register.bind(this),writable:!1},unregister:{configurable:!1,enumerable:!0,value:this.unregister.bind(this),writable:!1},deselectItem:{configurable:!1,enumerable:!0,value:this.deselectItem.bind(this),writable:!1},__registeredTriggers__:{configurable:!1,enumerable:!1,value:new Map,writable:!1}})}deselectItem(){for(const a of this.__optionElements__.values())a.classList.remove("active")}setSelectedAbility(a,b){if("string"===typeof a&&0!==a.length&&"string"===typeof b&&0!==b.length){b=
a.toLowerCase();a=a.toLowerCase();let c=!1;for(const d of this.__optionElements__.values())d.tryGetAttribute("pso2data-ability-id").toLowerCase()===b&&d.tryGetAttribute("pso2data-ability-level").toLowerCase()===a?(d.classList.add("active"),c=!0):d.classList.remove("active");if(c&&this.__currentHub__&&"function"===typeof this.__currentHub__.onSelection)this.__currentHub__.onSelection(this,this.selectedAbility)}}register(a){if(!this.__registeredTriggers__.has(a)){var b=new bootstrap.Popover(a,{trigger:"manual",
title:"Select special ability",html:!0,boundary:document.body,content:this.element,customClass:"max-vh-100"}),c={configurable:!1,enumerable:!0,value:null,writable:!0};c=Object.seal(Object.defineProperties({},{onSelection:c,onPopupShowing:c,onPopupShown:c}));var d=Object.freeze([this,a]);b=Object.seal({isShowing:!1,eShowing:UIPSO2AbilitySelectPopup.onShowing.bind(d),eShown:UIPSO2AbilitySelectPopup.onShown.bind(d),eHiding:UIPSO2AbilitySelectPopup.onHiding.bind(d),eTrigger:UIPSO2AbilitySelectPopup.onTriggering.bind(d),
callbackHub:c,controller:b});this.__registeredTriggers__.set(a,b);a.addEventListener("show.bs.popover",b.eShowing);a.addEventListener("shown.bs.popover",b.eShown);a.addEventListener("hide.bs.popover",b.eHiding);a.addEventListener("click",b.eTrigger);return c}}unregister(a){const b=this.__registeredTriggers__.get(a);b&&(this.__registeredTriggers__.delete(a),a.removeEventListener("show.bs.popover",b.eShowing),a.removeEventListener("shown.bs.popover",b.eShown),a.removeEventListener("hide.bs.popover",
b.eHiding),a.removeEventListener("click",b.eTrigger),(a=b.controller)&&"function"===typeof a.dispose&&a.dispose())}get selectedItem(){if(0===this.__optionElements__.length)return null;var a=this.__list__.querySelector("a.active");if(!a)return null;var b=a.getAttribute("pso2data-ability-id")||"";if(!b)return null;a=a.getAttribute("pso2data-ability-level")||"";return a?(b=AbilityTable.getAbility(b))?b.level[a]||null:null:null}get selectedAbility(){if(0===this.__optionElements__.length)return null;var a=
this.__list__.querySelector("a.active");if(!a)return null;var b=a.getAttribute("pso2data-ability-id")||"";if(!b)return null;a=a.getAttribute("pso2data-ability-level")||"";return a?(b=AbilityTable.getAbility(b))&&b.level[a]?Object.freeze({ability:b,level:a}):null:null}set selectedItem(a){if("string"===typeof a&&0!==a.length){a=a.toLowerCase();let b=!1;for(const c of this.__optionElements__.values()){let d=c.getAttribute("pso2data-ability-name").toLowerCase();if(d===a)c.classList.add("active"),b=!0;
else if(d=c.getAttribute("pso2data-ability-namejp"))d=d.toLowerCase(),d===a?(c.classList.add("active"),b=!0):c.classList.remove("active")}if(b&&this.__currentHub__&&"function"===typeof this.__currentHub__.onSelection)this.__currentHub__.onSelection(this,this.selectedAbility)}}get selectedElement(){return 0===this.__optionElements__.length?null:this.__list__.querySelector(".active")}set selectedElement(a){if(a instanceof HTMLAnchorElement){let b=!1;for(const c of this.__optionElements__.values())Object.is(c,
a)?(c.classList.add("active"),b=!0):c.classList.remove("active");if(b&&this.__currentHub__&&"function"===typeof this.__currentHub__.onSelection)this.__currentHub__.onSelection(this,this.selectedAbility)}}get optionElements(){return this.__optionElements__}get inputElement(){return this.__input__}get itemsElement(){return this.__list__}static *createOptions(a){var b=Object.getOwnPropertyNames(a.level);for(const c of b){b=document.createElement("a");const d=a.name,e=a.namejp,f=e&&e!==d;b.textContent=
f?`${d} ${c} (${e} ${c})`:`${d} ${c}`;b.setAttribute("pso2data-ability-id",d);b.setAttribute("pso2data-ability-level",c);b.setAttribute("pso2data-ability-name",`${d} ${c}`);f&&b.setAttribute("pso2data-ability-namejp",`${e} ${c}`);b.classList.add("list-group-item","list-group-item-action");b.href="javascript:void(0);";b.tabIndex=-1;yield b}}}UIPSO2AbilitySelectPopup.tryGetAttribute=function(a){return this.getAttribute(a)||""};
UIPSO2AbilitySelectPopup.onInputTextChanged=function(a){if(!this.processingInput){this.processingInput=!0;a=this.__input__.value.toLowerCase();var b=this.__optionElements__;if(a){if(0!==b.length)for(const c of b.values())c.textContent.toLowerCase().includes(a)?c.classList.remove("d-none"):c.classList.add("d-none")}else if(0!==b.length)for(const c of b.values())c.classList.remove("d-none");this.processingInput=!1}};
UIPSO2AbilitySelectPopup.onSelecting=function(a){this.processingSelecting||(this.processingSelecting=!0,this.selectedElement=a.target,this.processingSelecting=!1)};UIPSO2AbilitySelectPopup.onTriggering=function(a){const [b,c]=this;for(const [d,e]of b.__registeredTriggers__.entries())Object.is(c,d)?e.isShowing?e.controller.hide():e.controller.show():e.isShowing&&e.controller.hide()};
UIPSO2AbilitySelectPopup.onFocusCheck=function(a){if(this.element.matches(":focus-within"))a.preventDefault();else for(const b of this.__registeredTriggers__.values())b.isShowing&&b.controller.hide()};
UIPSO2AbilitySelectPopup.onShowing=function(a){const [b,c]=this,d=b.__registeredTriggers__.get(c);if(d&&!d.isShowing&&(d.isShowing=!0,b.__currentHub__=d.callbackHub,b.__input__.addEventListener("keyup",b.__onInputTextChanged__),b.__input__.addEventListener("blur",b.__onInputTextChanged__,!0),b.__list__.addEventListener("click",b.__onSelecting__,!0),b.__list__.addEventListener("focusout",b.__onFocusCheck__),"function"===typeof d.callbackHub.onPopupShowing))d.callbackHub.onPopupShowing(b,a)};
UIPSO2AbilitySelectPopup.onShown=function(a){const [b,c]=this,d=b.__registeredTriggers__.get(c);if(d&&d.isShowing&&"function"===typeof d.callbackHub.onPopupShown)d.callbackHub.onPopupShown(b,a)};
UIPSO2AbilitySelectPopup.onHiding=function(a){const [b,c]=this;if(a=b.__registeredTriggers__.get(c))a.isShowing=!1;b.__input__.removeEventListener("keyup",b.__onInputTextChanged__);b.__input__.removeEventListener("blur",b.__onInputTextChanged__,!0);b.__list__.removeEventListener("click",b.__onSelecting__,!0);b.__list__.removeEventListener("focusout",b.__onFocusCheck__);b.__currentHub__=null};
